---
import Footer from "../components/Footer.astro";
import Crumb from "../components/header/Crumb.astro";
import HeaderBreadcrumbs from "../components/header/HeaderBreadcrumbs.astro";
import PageHeader from "../components/header/PageHeader.astro";
import PageHeaderTitle from "../components/header/PageHeaderTitle.astro";
import Base from "../layouts/Base.astro";
import SponsorBubbles from "../components/home/SponsorBubbles.astro";
import { getCollection } from "astro:content";
import { previousSponsors } from "../data/previousSponsors";

const sponsors = await getCollection("sponsors", ({ id }) => {
  return !id.startsWith("_");
});

const tierOrder = ["diamond", "platinum", "gold", "standard", "in-kind"];
const sponsorsByTier = sponsors.reduce((acc, sponsor) => {
  const tier = sponsor.data.tier;
  if (!acc[tier]) {
    acc[tier] = [];
  }
  acc[tier].push(sponsor);
  return acc;
}, {} as Record<string, typeof sponsors>);

const tierLabels: Record<string, string> = {
  diamond: "Diamond Sponsors",
  platinum: "Platinum Sponsor",
  gold: "Gold Sponsors",
  standard: "Sponsors",
  "in-kind": "In-Kind Sponsors",
};

const prospectusUrl = "/files/PyCon AU 2026 Sponsorship Prospectus v2.pdf";
---

<Base title="Sponsors">
  <PageHeader dark={true} starColour="lime">
    <HeaderBreadcrumbs colour="lavender">
    </HeaderBreadcrumbs>
    <PageHeaderTitle textColour="lavender">
      <h1>Sponsors</h1>
    </PageHeaderTitle>
    <div
      class="fadeInUp flex flex-col lg:flex-row justify-between items-center bg-violet lg:py-0 py-5 gap-5 lg:gap-0 lg:pl-10 lg:h-[82px] lg:rounded-r-[89px] mt-20"
    >
      <span
        class="lg:text-left text-center text-lg font-sans leading-[1.3] font-semibold text-stone px-5 lg:px-0"
        >Become a sponsor today!</span
      >
      <a href={prospectusUrl} class="btn-arrow btn-arrow--lavender h-full rounded-[89px]! hover:rounded-none!"
        >Download Prospectus</a
      >
    </div>
  </PageHeader>

  <section>
    <div class="header-divider header-divider--lavender"></div>

    <div class="bg-stone py-20">
      <div class="container">
        <div class="lg:w-[85%] w-full mx-auto">
          {
            sponsors.length >0 ? (
              <p class="text-intro font-medium text-charcoal lg:w-[80%] fadeInUp" style="translate: none; rotate: none; scale: none; transform: translate(0px, 0px); opacity: 1;">
              Community conference like PyCon AU rely heavily on the generous support of our sponsors, without whom we could not enjoy many of the conference experiences we celebrate!
              </p>
            ) : null
          }

          {tierOrder.map((tier) => {
            let tierSponsors = sponsorsByTier[tier];

            // Combine standard and digital sponsors
            if (tier === "standard") {
              const standardSponsors = sponsorsByTier["standard"] || [];
              const digitalSponsors = sponsorsByTier["digital"] || [];
              tierSponsors = [...standardSponsors, ...digitalSponsors];
            }

            if (!tierSponsors || tierSponsors.length === 0) return null;

            const isPremium = tier === "diamond" || tier === "platinum" || tier === "gold";

            return (
              <div class="space-y-7 pt-24">
                <h2 class="fadeInUp lg:text-6xl text-5xl font-serif -tracking-[0.04em] text-center pb-7">
                  {tierLabels[tier]}
                </h2>

                {isPremium ? (
                  <div class="space-y-5">
                    {tierSponsors.map(async (sponsor) => {
                      const { Content } = await sponsor.render();
                      return (
                        <div class="fadeInUp bg-white flex lg:flex-row flex-col rounded-[3.125rem] lg:p-14 p-10 gap-14">
                          <img
                            src={`/images/sponsors/${sponsor.data.logo}`}
                            class="lg:w-auto w-[190px]"
                            alt={sponsor.data.name}
                          />
                          <div class="space-y-5 lg:w-[50%]">
                            <h3 class="text-3xl font-semibold text-charcoal">
                              {sponsor.data.name}
                            </h3>
                            <div class="text-sm font-medium leading-normal tracking-[0.01em]">
                              <Content />
                            </div>
                            {sponsor.data.website && (
                              <a
                                href={sponsor.data.website}
                                class="text-base font-medium font-sans leading-[1.2]"
                              >
                                {new URL(sponsor.data.website).hostname}
                              </a>
                            )}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                ) : (
                  <div class={tierSponsors.length === 1 ? "flex justify-center" : "grid lg:grid-cols-2 grid-cols-1 gap-x-5 gap-y-10"}>
                    {tierSponsors.map(async (sponsor) => {
                      const { Content } = await sponsor.render();
                      return (
                        <div class={`fadeInUp bg-white flex flex-col items-center rounded-[3.125rem] lg:p-14 p-10 gap-14 ${tierSponsors.length === 1 ? "lg:w-[50%]" : ""}`}>
                          <img
                            src={`/images/sponsors/${sponsor.data.logo}`}
                            class="lg:w-auto w-[190px]"
                            alt={sponsor.data.name}
                          />
                          <div class="space-y-5">
                            <h3 class="text-3xl font-semibold text-charcoal">
                              {sponsor.data.name}
                            </h3>
                            <div class="text-sm font-medium leading-normal tracking-[0.01em]">
                              <Content />
                            </div>
                            {sponsor.data.website && (
                              <a
                                href={sponsor.data.website}
                                class="text-base font-medium font-sans leading-[1.2]"
                              >
                                {new URL(sponsor.data.website).hostname}
                              </a>
                            )}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                )}
              </div>
            );
          })}
        </div>
      </div>
    </div>
  </section>

  <section class="bg-stone pt-10 pb-32 mt-[-1px] relative after:content-[''] after:absolute after:z-10 after:top-[25%] after:left-0 after:w-full after:h-full after:bg-[url('/images/bg-pattern.svg')] after:bg-cover after:bg-center after:bg-no-repeat">
    <div class="container relative z-20">
      <div class="fadeInUp text-center space-y-10 text-black">
        <h3 class="lg:text-5xl text-4xl font-serif">Previously sponsored by</h3>
      </div>

      <!-- Previous sponsors -->
      <SponsorBubbles staticLogos={previousSponsors} />

      <div class="fadeInUp h-[81px] flex justify-center mt-14 mx-auto">
        <a href={prospectusUrl} class="btn-arrow btn-arrow--lemon btn-arrow--medium"
          ><span>Sponsor PyCon AU today!</span></a
        >
      </div>

      <div class="flex justify-center group pt-20">
        <img
          src="/images/snake.svg"
          alt="snake"
          class="group-hover:rotate-y-180 transition-all duration-300"
        />
      </div>
    </div>
  </section>

  {/*
  <section class="bg-lime pt-20">
    <div class="container">
      <div class="grid lg:grid-cols-2 gap-5 pb-20">
        <a
          href="#"
          class="btn-arrow btn-arrow--emerald btn-arrow--2col fadeInUp"
          ><span>Call to Action Link</span></a
        >
        <a
          href="#"
          class="btn-arrow btn-arrow--emerald btn-arrow--2col fadeInUp"
          ><span>Call to Action Link</span></a
        >
      </div>
    </div>
  </section>
  */}

  <Footer />

  <!-- Main scripts (will be added in Phase 5) -->
  <script src="/src/scripts/animations.js"></script>
</Base>
